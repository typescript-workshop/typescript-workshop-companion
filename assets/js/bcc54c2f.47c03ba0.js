"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[890],{1736:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"atelier/selectionner-des-champs","title":"Exercice 4","description":"Nous vous proposons de typer la fonction selectFields qui, \xe0 partir du typage de notre database, sera capable d\'inf\xe9rer les noms des champs qu\'il est possible de s\xe9lectionner au sein d\'une table.","source":"@site/docs/atelier/4-selectionner-des-champs.md","sourceDirName":"atelier","slug":"/atelier/selectionner-des-champs","permalink":"/typescript-workshop-companion/docs/atelier/selectionner-des-champs","draft":false,"unlisted":false,"editUrl":"https://github.com/typescript-workshop/typescript-workshop-companion/tree/main/packages/create-docusaurus/templates/shared/docs/atelier/4-selectionner-des-champs.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Exercice 3","permalink":"/typescript-workshop-companion/docs/atelier/selectionner-une-table"},"next":{"title":"Exercice 5","permalink":"/typescript-workshop-companion/docs/atelier/selectionner-tous-les-champs"}}');var t=n(4848),r=n(8453);const o={sidebar_position:4},c="Exercice 4",l={},d=[{value:"Indice 1",id:"indice-1",level:2},{value:"Indice 2",id:"indice-2",level:2},{value:"Indice 3",id:"indice-3",level:2},{value:"Indice 4",id:"indice-4",level:2},{value:"Solution",id:"solution",level:2}];function a(e){const s={a:"a",admonition:"admonition",code:"code",del:"del",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:i}=s;return i||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"exercice-4",children:"Exercice 4"})}),"\n",(0,t.jsxs)(s.p,{children:["Nous vous proposons de typer la fonction ",(0,t.jsx)(s.code,{children:"selectFields"})," qui, \xe0 partir du typage de notre database, sera capable d'inf\xe9rer les noms des champs qu'il est possible de s\xe9lectionner au sein d'une table."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"selectFields autocomplete",src:n(2295).A+"",width:"984",height:"338"})}),"\n",(0,t.jsxs)(s.p,{children:["Rendez-vous dans le fichier ",(0,t.jsx)(s.code,{children:"4-selectionner-des-champs.ts"})," et ",(0,t.jsx)(s.code,{children:"db.ts"})," pour l'impl\xe9mentation."]}),"\n",(0,t.jsx)(s.p,{children:"\xc0 vous de jouer !"}),"\n",(0,t.jsx)(s.admonition,{title:"Ressources",type:"tip",children:(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"/typescript-workshop-companion/docs/typescript/generic",children:"Types g\xe9n\xe9riques"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"/typescript-workshop-companion/docs/typescript/conditional-types",children:"Types conditionnels"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"/typescript-workshop-companion/docs/typescript/keyof-lookup",children:"KeyOf & lookup"})}),"\n"]})}),"\n",(0,t.jsx)(s.h2,{id:"indice-1",children:"Indice 1"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Pr\xe9ciser le contexte"}),(0,t.jsxs)(s.p,{children:["Comme pr\xe9c\xe9demment, on peut envisager de construire un type interm\xe9diaire pour pr\xe9ciser la signature du ",(0,t.jsx)(s.em,{children:"contexte"})," pass\xe9 ",(0,t.jsx)(s.code,{children:"selectFields"}),". \xc0 ce stade ",(0,t.jsx)(s.code,{children:"selectFields"})," devra pouvoir \xeatre invoqu\xe9 avec le contexte d'une op\xe9ration de s\xe9lection sur une table membre d'une base de donn\xe9e... ",(0,t.jsx)(s.em,{children:"donn\xe9e"})," (",(0,t.jsx)(s.strong,{children:"any"})," ?)."]})]}),"\n",(0,t.jsx)(s.h2,{id:"indice-2",children:"Indice 2"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Le champ des champs possibles"}),(0,t.jsx)(s.p,{children:"Nous sommes dans un cas similaire \xe0 l'exercice pr\xe9c\xe9dent, simplement cette fois-ci, on veut pouvoir inf\xe9rer les types de propri\xe9t\xe9s nich\xe9es un peu plus profond\xe9ment que les noms des tables."}),(0,t.jsxs)(s.p,{children:["Suite \xe0 l'invocation de ",(0,t.jsx)(s.code,{children:"selectFrom"})," on dispose, dans notre ",(0,t.jsx)(s.em,{children:"contexte"})," d'un peu plus d'information : on sait que nous construisons une op\xe9ration ",(0,t.jsx)(s.code,{children:"select"})," et surtout quelle table nous allons interroger. Il est alors possible d'extraire, depuis le ",(0,t.jsx)(s.em,{children:"contexte"}),", les ",(0,t.jsx)(s.del,{children:"types des cl\xe9s"})," ",(0,t.jsx)(s.em,{children:"noms de champs"})," de la table cibl\xe9e et ainsi faire en sorte que ",(0,t.jsx)(s.code,{children:"selectFields"})," n'accepte en second param\xe8tre qu'un tableau dont les \xe9l\xe9ments sont des membres de champs de la table cible."]})]}),"\n",(0,t.jsx)(s.h2,{id:"indice-3",children:"Indice 3"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"La cl\xe9 des champs"}),(0,t.jsxs)(s.p,{children:["Il est tout \xe0 fait possible de d\xe9finir un ",(0,t.jsx)(s.em,{children:"lookup type"})," \xe0 partir d'un autre ",(0,t.jsx)(s.em,{children:"lookup type"}),". Notamment ici, nous cherchons \xe0 identifier les cl\xe9s membres d'une table, elle-m\xeame membre d'une base de donn\xe9e, et ceci afin de sp\xe9cifier que le second param\xe8tre de ",(0,t.jsx)(s.code,{children:"selectFields"})," est un tableau dont les \xe9l\xe9ments sont du type desdites cl\xe9s."]})]}),"\n",(0,t.jsx)(s.h2,{id:"indice-4",children:"Indice 4"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Oups !"}),(0,t.jsxs)(s.p,{children:["Vous avez peut-\xeatre une erreur TypeScript d\xfb \xe0 un manque de pr\xe9cision sur le type de l'op\xe9ration telle qu'elle est retourn\xe9e par ",(0,t.jsx)(s.code,{children:"selectFrom"})," (cf. l'exercice pr\xe9c\xe9dent). Dans ce cas, il est utile de pr\xe9ciser au compilateur qu'il doit inf\xe9rer le type le plus pr\xe9cis \xe0 partir de la valeur retourn\xe9e par ",(0,t.jsx)(s.code,{children:"selectFrom"}),"."]})]}),"\n",(0,t.jsx)(s.h2,{id:"solution",children:"Solution"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Avant de d\xe9plier pour afficher la solution, n'h\xe9sitez pas \xe0 nous solliciter ! "}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:'type SelectableContext<DB> = EmptyContext<DB> & {\n  _operation: "select";\n  _table: keyof DB;\n};\ntype AnySelectableContext = SelectableContext<any>;\nexport const selectFields = <Ctx extends AnySelectableContext>(\n  ctx: Ctx,\n  fieldNames: (keyof Ctx["$db"][Ctx["_table"]])[]\n) => ({\n  ...ctx,\n  _fields: fieldNames,\n});\n'})})]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},2295:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/selectFields_autocomplete-aff62fb1ff6536196e2a89805c5712e6.png"},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>c});var i=n(6540);const t={},r=i.createContext(t);function o(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);